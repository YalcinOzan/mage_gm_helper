<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mage: Master Node (Pro)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Montserrat:wght@500;600;700;800;900&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           1. THEME & VARIABLES
           ========================================= */
        :root {
            --bg-body: #050507; --bg-panel: #0f0f12; --bg-card: #18181b; --bg-input: #09090b;
            --border: #27272a; --border-hover: #3f3f46;
            --primary: #8b5cf6; --primary-hover: #7c3aed; --primary-dim: rgba(139, 92, 246, 0.15);
            --accent: #06b6d4; --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
            --text-main: #fafafa; --text-muted: #a1a1aa;
            --radius: 12px; --header-height: 70px; --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --ease: cubic-bezier(0.23, 1, 0.32, 1);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Inter', sans-serif; margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; letter-spacing: -0.015em; }
        
        /* =========================================
           2. HEADER & NAV
           ========================================= */
        .app-header { height: var(--header-height); padding: 0 20px; background: rgba(15, 15, 18, 0.8); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); z-index: 50; display: flex; align-items: center; justify-content: center; }
        .search-bar { width: 100%; max-width: 600px; background: var(--bg-input); border: 1px solid var(--border); padding: 12px 16px; border-radius: 10px; color: #fff; font-family: inherit; font-size: 0.95rem; outline: none; transition: all 0.2s var(--ease); box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        .search-bar:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-dim); background: #121215; }
        .nav-tabs { display: flex; background: var(--bg-body); border-bottom: 1px solid var(--border); padding: 0 10px; flex-shrink: 0; overflow-x: auto; }
        .nav-btn { flex: 1; min-width: 80px; padding: 16px 12px; background: transparent; border: none; color: var(--text-muted); font-weight: 600; font-size: 0.9rem; cursor: pointer; position: relative; transition: color 0.2s; white-space: nowrap; }
        .nav-btn:hover { color: #fff; }
        .nav-btn.active { color: var(--primary); }
        .nav-btn.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: var(--primary); border-radius: 3px 3px 0 0; box-shadow: 0 -2px 8px var(--primary-dim); }
        
        /* =========================================
           3. LAYOUT & CARDS
           ========================================= */
        .content-area { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 24px 16px; background: var(--bg-panel); position: relative; }
        .tab-page { display: none; max-width: 800px; margin: 0 auto; padding-bottom: 80px; animation: slideUp 0.3s var(--ease); }
        .tab-page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .sub-nav { display: flex; gap: 6px; margin-bottom: 24px; padding: 4px; background: var(--bg-input); border-radius: 12px; border: 1px solid var(--border); }
        .sub-nav-btn { flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-muted); font-weight: 700; font-size: 0.8rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .sub-nav-btn:hover { color: #fff; }
        .sub-nav-btn.active { background: var(--bg-card); color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.2); border: 1px solid var(--border); }
        .sub-tab-content { display: none; }
        .sub-tab-content.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; transition: transform 0.2s, border-color 0.2s; }
        .card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .card-title { font-weight: 800; color: var(--text-main); font-size: 1rem; margin-bottom: 12px; display: block; border-bottom: 1px solid var(--border); padding-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .card-list { list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: var(--text-muted); }
        .card-list li { margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .card-list span { color: var(--primary); font-weight: 700; background: var(--primary-dim); padding: 2px 6px; border-radius: 4px; font-size: 0.8em; min-width: 24px; text-align: center; }
        
        /* =========================================
           4. ACCORDIONS & DATA
           ========================================= */
        .accordion { display: flex; flex-direction: column; gap: 12px; }
        .acc-item { border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; background: var(--bg-card); transition: border-color 0.2s; }
        .acc-header { padding: 16px; background: transparent; font-weight: 600; font-size: 0.95rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; user-select: none; color: var(--text-main); transition: background 0.2s; }
        .acc-header:hover { background: rgba(255,255,255,0.03); }
        .acc-item.open { border-color: var(--border-hover); }
        .acc-item.open .acc-header { background: rgba(255,255,255,0.05); color: var(--primary); }
        .acc-content { display: none; border-top: 1px solid var(--border); background: rgba(0,0,0,0.15); }
        .acc-item.open .acc-content { display: block; }
        .data-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .data-row:last-child { border-bottom: none; }
        .data-name { font-weight: 600; color: #fff; display: block; margin-bottom: 2px; }
        .data-meta { font-family: 'Courier Prime', monospace; color: var(--primary); font-size: 0.85rem; text-align: right; background: rgba(0,0,0,0.2); padding: 2px 6px; border-radius: 4px; }
        .data-desc { display: block; font-size: 0.8rem; color: var(--text-muted); font-style: italic; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { text-align: left; padding: 12px 16px; color: var(--text-muted); border-bottom: 1px solid var(--border); font-weight: 700; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; }
        td { padding: 12px 16px; border-bottom: 1px solid var(--border); color: var(--text-main); vertical-align: top; }
        .hl-red { color: var(--danger); font-weight: bold; } 
        .hl-green { color: var(--success); font-weight: bold; } 
        .hl-yellow { color: var(--warning); font-weight: bold; }
        
        /* =========================================
           5. RITUALMATIC CONTROLS
           ========================================= */
        .rit-container { font-family: 'Montserrat', sans-serif; display: flex; flex-direction: column; gap: 24px; }
        .rit-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 16px; margin-bottom: 8px; }
        .rit-title { font-size: 1.2rem; font-weight: 800; margin: 0; letter-spacing: -0.5px; }
        .mode-switch { display: flex; background: var(--bg-input); padding: 4px; border-radius: 12px; border: 1px solid var(--border); }
        .mode-opt { flex: 1; text-align: center; padding: 12px; font-size: 0.85rem; font-weight: 700; cursor: pointer; border-radius: 8px; color: var(--text-muted); transition: all 0.2s; }
        .mode-opt.active { background: var(--bg-card); color: #fff; box-shadow: var(--shadow-sm); border: 1px solid var(--border); }
        
        .hud-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 8px; }
        .hud-box { background: linear-gradient(145deg, var(--bg-card), #1c1c22); border-radius: 16px; padding: 24px; text-align: center; border: 1px solid var(--border); position: relative; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .hud-lbl { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 800; color: var(--text-muted); display: block; margin-bottom: 8px; }
        .hud-val { font-size: 2.8rem; font-weight: 900; color: #fff; background: transparent; border: none; width: 100%; text-align: center; font-family: 'Montserrat', sans-serif; text-shadow: 0 0 10px rgba(255,255,255,0.1); }
        .val-diff { color: #c4b5fd; } .val-goal { color: #6ee7b7; } .modified { color: var(--warning) !important; text-decoration: underline; text-decoration-style: dotted; }
        
        .panel, .control-panel { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 24px; display: flex; flex-direction: column; gap: 20px; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 12px; margin-bottom: -8px; }
        .ph-title { font-weight: 800; text-transform: uppercase; font-size: 0.8rem; color: var(--text-muted); letter-spacing: 1px; }
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        .rit-label { font-size: 0.75rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; cursor: help; letter-spacing: 0.5px; }
        .rit-label:hover { color: var(--primary); }
        
        .counter { display: flex; background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; height: 48px; }
        .btn-cnt { width: 56px; border: none; background: transparent; color: var(--text-muted); font-size: 1.2rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-cnt:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .btn-cnt:active { background: var(--primary-dim); }
        .cnt-display { flex: 1; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.1rem; border-left: 1px solid var(--border); border-right: 1px solid var(--border); }
        
        select, .rit-select { width: 100%; background: var(--bg-input); border: 1px solid var(--border); color: #fff; padding: 12px 16px; border-radius: 10px; outline: none; font-family: 'Montserrat', sans-serif; font-weight: 600; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23a1a1aa' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; }
        select:focus { border-color: var(--primary); }
        
        .tools-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .btn-tool { background: var(--bg-input); border: 1px solid var(--border); padding: 16px; border-radius: 12px; text-align: center; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); cursor: pointer; transition: 0.2s; }
        .btn-tool:hover { border-color: var(--text-muted); color: #fff; }
        .btn-tool.active { background: var(--primary-dim); border-color: var(--primary); color: #fff; box-shadow: 0 0 15px var(--primary-dim); }
        .btn-tool.neg.active { background: rgba(239, 68, 68, 0.15); border-color: var(--danger); color: var(--danger); }
        
        /* Slider */
        .slider-card { background: var(--bg-input); padding: 16px; border-radius: 12px; border: 1px solid var(--border); }
        .slider-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 12px; }
        .slider-val { font-size: 1.1rem; font-weight: 800; color: #fff; }
        .slider-cost { font-size: 0.8rem; font-weight: 600; color: var(--success); }
        input[type=range] { width: 100%; cursor: pointer; margin: 0; accent-color: var(--primary); height: 6px; border-radius: 3px; }

        /* New Square Button (Spec) */
        .btn-square {
            width: 100%; height: 44px; 
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease;
        }
        .btn-square:hover { border-color: var(--text-muted); background: rgba(255,255,255,0.02); }
        .btn-square.checked { background: var(--primary); border-color: var(--primary); box-shadow: 0 0 15px var(--primary-dim); }
        .btn-square-inner { width: 12px; height: 12px; border: 2px solid var(--text-muted); border-radius: 3px; transition: 0.2s; }
        .btn-square.checked .btn-square-inner { background: #fff; border-color: #fff; transform: scale(1.2); }

        /* Action Buttons */
        .btn-cast { width: 100%; padding: 24px; border: none; border-radius: 16px; font-family: inherit; font-size: 1.2rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; color: #fff; margin-top: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); transition: transform 0.1s, filter 0.2s; }
        .btn-cast:hover { filter: brightness(1.1); }
        .btn-cast:active { transform: scale(0.98); }
        .style-inst { background: linear-gradient(135deg, #f97316, #ea580c); }
        .style-rit { background: linear-gradient(135deg, #8b5cf6, #6d28d9); }
        .style-pause { background: linear-gradient(135deg, #f59e0b, #d97706); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
        
        .btn-safety { display: flex; align-items: center; gap: 12px; justify-content: center; padding: 12px; border-radius: 10px; background: rgba(249, 115, 22, 0.1); border: 1px solid rgba(249, 115, 22, 0.3); color: #f97316; cursor: pointer; font-weight: 700; font-size: 0.8rem; text-transform: uppercase; transition: 0.2s; margin-top: 8px; }
        .btn-safety svg { width: 20px; height: 20px; fill: currentColor; }
        .btn-safety.active { background: #f97316; color: #000; border-color: #f97316; }
        
        /* =========================================
           6. LOGS & GENERATORS
           ========================================= */
        #log-container { display: none; background: #000; padding: 20px; border-radius: 16px; margin-top: 24px; border: 1px solid var(--border); }
        .log-head { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: 800; color: var(--text-muted); margin-bottom: 16px; text-transform: uppercase; }
        .log-scroll { max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding-right: 4px; }
        .entry { background: var(--bg-card); padding: 16px; border-radius: 10px; border-left: 4px solid #444; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; animation: slideIn 0.3s ease-out; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .entry.success { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
        .entry.fail { border-color: var(--warning); background: rgba(245, 158, 11, 0.05); }
        .entry.botch { border-color: var(--danger); background: rgba(239, 68, 68, 0.05); }
        .prog-bg { height: 10px; background: var(--bg-input); border-radius: 5px; overflow: hidden; margin-bottom: 16px; border: 1px solid var(--border); }
        .prog-fill { height: 100%; background: var(--success); width: 0%; transition: width 0.3s; box-shadow: 0 0 10px var(--success); }
        
        .gen-btn { width: 100%; padding: 16px; background: var(--bg-input); border: 1px solid var(--border); color: #fff; border-radius: 10px; font-size: 0.85rem; font-weight: 700; cursor: pointer; text-transform: uppercase; margin-bottom: 5px; transition: 0.2s; }
        .gen-btn:hover { border-color: var(--accent); background: rgba(6, 182, 212, 0.1); color: var(--accent); }
        .gen-res { font-size: 1.1rem; font-weight: 700; color: var(--accent); min-height: 24px; text-align: center; margin-bottom: 15px; font-family: 'Courier Prime', monospace; margin-top: 10px; }
        .gen-input { width: 70px; text-align: center; background: var(--bg-input); border: 1px solid var(--border); color: #fff; border-radius: 8px; padding: 12px; font-weight: 700; font-family: 'Montserrat', sans-serif; outline: none; }
        .gen-input:focus { border-color: var(--primary); }
        
        .btn-reset { background: transparent; border: 1px solid var(--danger); color: var(--danger); padding: 8px 16px; border-radius: 8px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; cursor: pointer; transition: 0.2s; }
        .btn-reset:hover { background: rgba(239, 68, 68, 0.1); }
        .mini-sel { background: transparent; border: none; color: var(--text-muted); font-weight: 800; font-size: 0.75rem; text-transform: uppercase; cursor: pointer; padding: 0; text-align: right; }
        
        #tooltip { position: fixed; display: none; pointer-events: none; z-index: 9999; background: rgba(24, 24, 27, 0.95); border: 1px solid var(--border); border-radius: 8px; padding: 12px; max-width: 280px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); font-family: 'Montserrat', sans-serif; backdrop-filter: blur(4px); }
        .tt-title { color: var(--primary); font-size: 0.7rem; font-weight: 900; text-transform: uppercase; margin-bottom: 4px; display: block; }
        .tt-desc { color: #ddd; font-size: 0.75rem; line-height: 1.4; }
        .tt-ref { color: var(--text-muted); font-size: 0.65rem; font-style: italic; margin-top: 8px; display: block; border-top: 1px solid #444; padding-top: 4px; }
        
        #error-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 10000; display: none; justify-content: center; align-items: center; animation: fadeIn 0.2s; }
        .modal-box { background: #1c1c24; border: 1px solid var(--danger); border-radius: 16px; padding: 32px; max-width: 350px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.8); }
        .modal-title { color: var(--danger); font-weight: 900; font-size: 1.4rem; margin-bottom: 12px; text-transform: uppercase; }
        .modal-text { color: #ccc; font-size: 1rem; margin-bottom: 24px; line-height: 1.5; }
        .modal-btn { background: var(--danger); border: none; color: #fff; padding: 14px 24px; border-radius: 10px; font-weight: 800; cursor: pointer; width: 100%; text-transform: uppercase; letter-spacing: 1px; }
        .modal-btn:hover { background: #dc2626; }
    </style>
</head>
<body>

    <div class="app-header">
        <input type="text" id="searchBox" class="search-bar" placeholder="Search Rotes, Rules, Spheres..." onkeyup="filterContent()">
    </div>

    <div class="nav-tabs">
        <button class="nav-btn" onclick="switchTab('tab-spheres', this)">üîÆ Spheres</button>
        <button class="nav-btn" onclick="switchTab('tab-rotes', this)">üìö Rotes</button>
        <button class="nav-btn" onclick="switchTab('tab-rules', this)">‚öñÔ∏è Rules</button>
        <button class="nav-btn active" onclick="switchTab('tab-tools', this)">üé≤ Tools</button>
    </div>

    <div class="content-area">
        
        <div id="tooltip">
            <span class="tt-title"></span>
            <span class="tt-desc"></span>
            <span class="tt-ref"></span>
        </div>
        
        <div id="error-modal">
            <div class="modal-box">
                <div class="modal-title">‚ö† Rule Violation</div>
                <div class="modal-text">Your Sphere rating cannot exceed your Arete rating.</div>
                <div class="tt-ref" style="margin-bottom:15px;">Reference: M20 Core Rulebook, p.251</div>
                <button class="modal-btn" onclick="closeError()">UNDERSTOOD</button>
            </div>
        </div>

        <div id="tab-spheres" class="tab-page">
                        <div class="grid-3">
                <div class="card"><span class="card-title">üåê Correspondence</span><ul class="card-list"><li><span>1</span> Perception</li><li><span>2</span> Sense/Touch</li><li><span>3</span> Pierce Space</li><li><span>4</span> Rend Space</li><li><span>5</span> Mutate Space</li></ul></div>
                <div class="card"><span class="card-title">üé≤ Entropy</span><ul class="card-list"><li><span>1</span> Sense Fate</li><li><span>2</span> Probability</li><li><span>3</span> Matter/Energy</li><li><span>4</span> Life/Death</li><li><span>5</span> Thought</li></ul></div>
                <div class="card"><span class="card-title">‚ö° Forces</span><ul class="card-list"><li><span>1</span> Perceive</li><li><span>2</span> Control Minor</li><li><span>3</span> Transmute Minor</li><li><span>4</span> Control Major</li><li><span>5</span> Mastery</li></ul></div>
                <div class="card"><span class="card-title">üß¨ Life</span><ul class="card-list"><li><span>1</span> Sense Life</li><li><span>2</span> Alter Simple</li><li><span>3</span> Alter Self</li><li><span>4</span> Alter Complex</li><li><span>5</span> Create Life</li></ul></div>
                <div class="card"><span class="card-title">üß± Matter</span><ul class="card-list"><li><span>1</span> Analysis</li><li><span>2</span> Transmute Basic</li><li><span>3</span> Alter Form</li><li><span>4</span> Complex</li><li><span>5</span> Create Matter</li></ul></div>
                <div class="card"><span class="card-title">üß† Mind</span><ul class="card-list"><li><span>1</span> Sense Thought</li><li><span>2</span> Read Surface</li><li><span>3</span> Mental Link</li><li><span>4</span> Control Mind</li><li><span>5</span> Create Mind</li></ul></div>
                <div class="card"><span class="card-title">‚ú® Prime</span><ul class="card-list"><li><span>1</span> Sense Prime</li><li><span>2</span> Fuel Pattern</li><li><span>3</span> Channel</li><li><span>4</span> Expel Energy</li><li><span>5</span> Mastery</li></ul></div>
                <div class="card"><span class="card-title">üëª Spirit</span><ul class="card-list"><li><span>1</span> Spirit Sight</li><li><span>2</span> Touch Spirit</li><li><span>3</span> Step Sideways</li><li><span>4</span> Bind Spirit</li><li><span>5</span> Forge Spirit</li></ul></div>
                <div class="card"><span class="card-title">‚è≥ Time</span><ul class="card-list"><li><span>1</span> Time Sense</li><li><span>2</span> Precognition</li><li><span>3</span> Time Control</li><li><span>4</span> Time Bubble</li><li><span>5</span> Time Travel</li></ul></div>
            </div>
        </div>

        <div id="tab-rotes" class="tab-page">
            <div class="accordion">
                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">‚öîÔ∏è Combat Rotes (Attack & Defense)</div>
                    <div class="acc-content">
                        <div class="data-row" data-search="Aggravated"><div class="data-info"><span class="data-name">Internal Burn (Agg)</span><span class="data-desc">Burns internal organs directly.</span></div><span class="data-meta">Life 3 + Forces 2</span></div>
                        <div class="data-row" data-search="Sunlight Vampire"><div class="data-info"><span class="data-name">Artificial Sunlight</span><span class="data-desc">True sunlight vs Vampires.</span></div><span class="data-meta">Forces 3 + Prime 2</span></div>
                        <div class="data-row" data-search="Lightning"><div class="data-info"><span class="data-name">Chain Lightning</span><span class="data-desc">Arcing electrical blast.</span></div><span class="data-meta">Forces 3 + Prime 2</span></div>
                        <div class="data-row" data-search="Punch"><div class="data-info"><span class="data-name">Chi-Fire Punch</span><span class="data-desc">Aggravated damage strike.</span></div><span class="data-meta">Prime 2 + Brawl</span></div>
                        <div class="data-row" data-search="Kinetic"><div class="data-info"><span class="data-name">Kinetic Strike</span><span class="data-desc">Increase velocity/impact.</span></div><span class="data-meta">Forces 2</span></div>
                        <div class="data-row" data-search="Psychic"><div class="data-info"><span class="data-name">Psychic Blast</span><span class="data-desc">Direct mental bashing.</span></div><span class="data-meta">Mind 3</span></div>
                        <div class="data-row" data-search="Shatter"><div class="data-info"><span class="data-name">Psychic Shatter</span><span class="data-desc">Mind-flaying Agg damage.</span></div><span class="data-meta">Mind 3 + Life 3</span></div>
                        <div class="data-row" data-search="Rot"><div class="data-info"><span class="data-name">Necrotic Rot</span><span class="data-desc">Rapid flesh decay.</span></div><span class="data-meta">Entropy 4 + Life 3</span></div>
                        <div class="data-row" data-search="Sniper"><div class="data-info"><span class="data-name">Curve Bullet</span><span class="data-desc">Alter trajectory.</span></div><span class="data-meta">Forces 2 + Corr 1</span></div>
                        <div class="data-row" data-search="Bomb"><div class="data-info"><span class="data-name">Living Bomb</span><span class="data-desc">Delayed explosion in body.</span></div><span class="data-meta">Life 4 + Time 4 + Forces 3</span></div>
                        <div class="data-row" data-search="Vampire"><div class="data-info"><span class="data-name">Chi-Vampire Strike</span><span class="data-desc">Drain Quint on hit.</span></div><span class="data-meta">Prime 3 + Brawl</span></div>
                        <div class="data-row" data-search="Spirit"><div class="data-info"><span class="data-name">Spirit Strike</span><span class="data-desc">Punch across Gauntlet.</span></div><span class="data-meta">Spirit 2 + Prime 2</span></div>
                        <div class="data-row" data-search="Disrupt"><div class="data-info"><span class="data-name">Disrupt Body</span><span class="data-desc">Stop heart/organ function.</span></div><span class="data-meta">Life 3 + Matter 2</span></div>
                        <div class="data-row" data-search="Bones"><div class="data-info"><span class="data-name">Rubbing Bones</span><span class="data-desc">Painful internal friction.</span></div><span class="data-meta">Prime 2</span></div>
                        <div class="data-row" data-search="Armor"><div class="data-info"><span class="data-name">Iron Skin</span><span class="data-desc">Soak Aggravated damage.</span></div><span class="data-meta">Life 3 + Matter 3</span></div>
                        <div class="data-row" data-search="Shield"><div class="data-info"><span class="data-name">Storm Cocoon</span><span class="data-desc">Shields from env/debris.</span></div><span class="data-meta">Forces 3 + Entropy 2</span></div>
                        <div class="data-row" data-search="Invis"><div class="data-info"><span class="data-name">Invisibility</span><span class="data-desc">Bends light.</span></div><span class="data-meta">Forces 2 (+ Matter 4)</span></div>
                        <div class="data-row" data-search="Silence"><div class="data-info"><span class="data-name">Silence Field</span><span class="data-desc">Dampens sound waves.</span></div><span class="data-meta">Forces 2</span></div>
                        <div class="data-row" data-search="Block"><div class="data-info"><span class="data-name">Mind Shield</span><span class="data-desc">Block telepathy.</span></div><span class="data-meta">Mind 1 + Prime 1</span></div>
                        <div class="data-row" data-search="Catch"><div class="data-info"><span class="data-name">Bullet Catch</span><span class="data-desc">Stop kinetic objects.</span></div><span class="data-meta">Forces 2</span></div>
                        <div class="data-row" data-search="Pain"><div class="data-info"><span class="data-name">Pain Shrug</span><span class="data-desc">Ignore wound penalties.</span></div><span class="data-meta">Mind 3 / Life 3</span></div>
                        <div class="data-row" data-search="Luck"><div class="data-info"><span class="data-name">Luck Shield</span><span class="data-desc">Deflect bad luck.</span></div><span class="data-meta">Entropy 2</span></div>
                        <div class="data-row" data-search="Null"><div class="data-info"><span class="data-name">Counter-Magic</span><span class="data-desc">General anti-magic zone.</span></div><span class="data-meta">Prime 2</span></div>
                        <div class="data-row" data-search="Blur"><div class="data-info"><span class="data-name">Slipstream</span><span class="data-desc">Vibrate to dodge.</span></div><span class="data-meta">Time 1 + Corr 1</span></div>
                    </div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">üß™ Alteration & Creation</div>
                    <div class="acc-content">
                        <div class="data-row" data-search="Object"><div class="data-info"><span class="data-name">Conjure Object</span><span class="data-desc">Create simple matter.</span></div><span class="data-meta">Matter 3 + Prime 2</span></div>
                        <div class="data-row" data-search="Zombie"><div class="data-info"><span class="data-name">Create Zombie</span><span class="data-desc">Reanimate corpse.</span></div><span class="data-meta">Life 2 + Spirit 2 + Prime 2</span></div>
                        <div class="data-row" data-search="Petrify"><div class="data-info"><span class="data-name">Petrify</span><span class="data-desc">Turn flesh to stone.</span></div><span class="data-meta">Life 4 + Matter 2</span></div>
                        <div class="data-row" data-search="Shape"><div class="data-info"><span class="data-name">Shapechange (Self)</span><span class="data-desc">Transform self.</span></div><span class="data-meta">Life 4</span></div>
                        <div class="data-row" data-search="Shape"><div class="data-info"><span class="data-name">Shapechange (Other)</span><span class="data-desc">Transform target.</span></div><span class="data-meta">Life 5</span></div>
                        <div class="data-row" data-search="Cyber"><div class="data-info"><span class="data-name">Install Cybernetics</span><span class="data-desc">Fuse flesh and machine.</span></div><span class="data-meta">Life 4 + Matter 4</span></div>
                        <div class="data-row" data-search="Chem"><div class="data-info"><span class="data-name">Chemical Synthesis</span><span class="data-desc">Drugs/poison.</span></div><span class="data-meta">Matter 2</span></div>
                        <div class="data-row" data-search="Temp"><div class="data-info"><span class="data-name">Control Temp</span><span class="data-desc">Heat up/Cool down.</span></div><span class="data-meta">Forces 2</span></div>
                        <div class="data-row" data-search="Light"><div class="data-info"><span class="data-name">Create Light</span><span class="data-desc">Create light source.</span></div><span class="data-meta">Forces 3 + Prime 2</span></div>
                        <div class="data-row" data-search="Buff"><div class="data-info"><span class="data-name">Battle Fury Mode</span><span class="data-desc">Buff Stats, No Fear.</span></div><span class="data-meta">Life 3 + Mind 3</span></div>
                    </div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">üöÄ Movement & Influence</div>
                    <div class="acc-content">
                        <div class="data-row" data-search="Teleport"><div class="data-info"><span class="data-name">Teleport Self</span><span class="data-desc">Instant travel.</span></div><span class="data-meta">Corr 3</span></div>
                        <div class="data-row" data-search="Teleport"><div class="data-info"><span class="data-name">Teleport Other</span><span class="data-desc">Move other person.</span></div><span class="data-meta">Corr 3 + Life 3</span></div>
                        <div class="data-row" data-search="Fly"><div class="data-info"><span class="data-name">Fly</span><span class="data-desc">Personal flight.</span></div><span class="data-meta">Forces 2 + Life 2</span></div>
                        <div class="data-row" data-search="Levitate"><div class="data-info"><span class="data-name">Levitate</span><span class="data-desc">Lift objects remotely.</span></div><span class="data-meta">Forces 2</span></div>
                        <div class="data-row" data-search="Umbra"><div class="data-info"><span class="data-name">Umbral Step</span><span class="data-desc">Enter Penumbra.</span></div><span class="data-meta">Spirit 3</span></div>
                        <div class="data-row" data-search="Blink"><div class="data-info"><span class="data-name">The Blink</span><span class="data-desc">Rapid teleport jumps.</span></div><span class="data-meta">Corr 3</span></div>
                        <div class="data-row" data-search="Car"><div class="data-info"><span class="data-name">Flying Vehicle</span><span class="data-desc">Enchant vehicle.</span></div><span class="data-meta">Forces 2 + Matter 2</span></div>
                        <div class="data-row" data-search="Portal"><div class="data-info"><span class="data-name">Open Portal</span><span class="data-desc">Open stable gate.</span></div><span class="data-meta">Corr 4</span></div>
                        <div class="data-row" data-search="TK"><div class="data-info"><span class="data-name">Telekinesis</span><span class="data-desc">Move objects with mind.</span></div><span class="data-meta">Mind 3 + Forces 2</span></div>
                        <div class="data-row" data-search="Mind"><div class="data-info"><span class="data-name">Mind Read</span><span class="data-desc">Deep probe.</span></div><span class="data-meta">Mind 3</span></div>
                        <div class="data-row" data-search="Aura"><div class="data-info"><span class="data-name">Read Aura</span><span class="data-desc">See emotions/health.</span></div><span class="data-meta">Mind 1 / Life 1</span></div>
                        <div class="data-row" data-search="Memory"><div class="data-info"><span class="data-name">Alter Memory</span><span class="data-desc">Edit/Wipe memories.</span></div><span class="data-meta">Mind 4</span></div>
                        <div class="data-row" data-search="Control"><div class="data-info"><span class="data-name">Possession</span><span class="data-desc">Control body.</span></div><span class="data-meta">Mind 4</span></div>
                        <div class="data-row" data-search="Dream"><div class="data-info"><span class="data-name">Dreamwalk</span><span class="data-desc">Enter dreams.</span></div><span class="data-meta">Mind 3</span></div>
                        <div class="data-row" data-search="Time"><div class="data-info"><span class="data-name">Postcognition</span><span class="data-desc">Past/Future sight.</span></div><span class="data-meta">Time 2</span></div>
                        <div class="data-row" data-search="EMP"><div class="data-info"><span class="data-name">Blackout (EMP)</span><span class="data-desc">Kill power grid.</span></div><span class="data-meta">Forces 2 (+ Mat 2)</span></div>
                        <div class="data-row" data-search="Traffic"><div class="data-info"><span class="data-name">Flip Traffic Lights</span><span class="data-desc">Change lights.</span></div><span class="data-meta">Forces 2 / Entropy 2</span></div>
                        <div class="data-row" data-search="ID"><div class="data-info"><span class="data-name">Instant Fake ID</span><span class="data-desc">Fool scanners.</span></div><span class="data-meta">Matter 2 + Entropy 3</span></div>
                        <div class="data-row" data-search="Weather"><div class="data-info"><span class="data-name">Weather Witching</span><span class="data-desc">Alter climate.</span></div><span class="data-meta">Forces 4 + Entropy 3</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-rules" class="tab-page">
            <div class="accordion">
                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">‚ö†Ô∏è Paradox Backlash (M20 Quickstart)</div>
                    <div class="acc-content">
                        <table>
                            <tr><th>Successes</th><th>Effect</th></tr>
                            <tr><td>1-5</td><td>1 pt/suc. Bashing Damage or Trivial Flaw.</td></tr>
                            <tr><td>6-10</td><td>1 pt/suc. Burn (Bashing) or Minor Flaw.</td></tr>
                            <tr><td>11-15</td><td>Lethal Burn + Significant Flaw (Discharge All).</td></tr>
                            <tr><td>16-20</td><td>Lethal + Permanent Paradox + Realm.</td></tr>
                            <tr><td class="hl-red">21+</td><td class="hl-red">Aggravated Burn + Perm Paradox + Spirit.</td></tr>
                        </table>
                    </div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">‚öîÔ∏è Weapons & Combat Maneuvers</div>
                    <div class="acc-content">
                        <strong style="display:block; padding:12px; color:var(--accent);">MANEUVERS (M20 Quickstart p.14)</strong>
                        <table>
                            <tr><th>Move</th><th>Diff</th><th>Damage</th></tr>
                            <tr><td>Punch</td><td>6</td><td>Str (B)</td></tr>
                            <tr><td>Kick</td><td>7</td><td>Str + 1 (B)</td></tr>
                            <tr><td>Grapple</td><td>6</td><td>Str (B)</td></tr>
                            <tr><td>Tackle</td><td>7</td><td>Str + 1 (B)</td></tr>
                            <tr><td>Claw/Bite</td><td>6</td><td>Str + 1 (L/A)</td></tr>
                            <tr><td>Dodge</td><td>6</td><td>- (Defense)</td></tr>
                        </table>
                        <strong style="display:block; padding:12px; color:var(--accent); border-top:1px solid var(--border);">WEAPONS</strong>
                        <table>
                            <tr><th>Weapon</th><th>Diff</th><th>Dmg</th><th>Range</th></tr>
                            <tr><td>Knife</td><td>4</td><td>Str+1L</td><td>-</td></tr>
                            <tr><td>Sword</td><td>6</td><td>Str+4L</td><td>-</td></tr>
                            <tr><td>Pistol (Lt)</td><td>6</td><td>4L</td><td>20</td></tr>
                            <tr><td>Pistol (Hv)</td><td>6</td><td>5L</td><td>30</td></tr>
                            <tr><td>Shotgun</td><td>6</td><td>8L</td><td>20</td></tr>
                            <tr><td>Rifle</td><td>7</td><td>8L</td><td>200+</td></tr>
                        </table>
                    </div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">üè• Damage & Healing</div>
                    <div class="acc-content">
                        <table>
                            <tr><th>Type</th><th>Recovery Time</th><th>Magickal Heal</th></tr>
                            <tr><td class="hl-green">Bashing</td><td>1 / Hour (Ex: Bruised-Wounded)</td><td>Life 2</td></tr>
                            <tr><td class="hl-yellow">Lethal</td><td>1 / Day (Ex: Bruised) - 1/Month</td><td>Life 3</td></tr>
                            <tr><td class="hl-red">Aggravated</td><td>1 / Week (per level)</td><td>Life 3 + Quint</td></tr>
                        </table>
                    </div>
                </div>

                <div class="acc-item">
                      <div class="acc-header" onclick="toggleAcc(this)">‚ú® Magickal Feats Difficulty</div>
                      <div class="acc-content">
                          <table>
                              <tr><th>Feat Type</th><th>Difficulty</th></tr>
                              <tr><td class="hl-green">Coincidental</td><td>Highest Sphere + 3</td></tr>
                              <tr><td class="hl-yellow">Vulgar (No Witness)</td><td>Highest Sphere + 4</td></tr>
                              <tr><td class="hl-red">Vulgar (Witnessed)</td><td>Highest Sphere + 5</td></tr>
                          </table>
                      </div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">üìà Experience Costs</div>
                    <div class="acc-content">
                        <table>
                            <tr><th>Trait</th><th>Cost</th></tr>
                            <tr><td>New Ability</td><td>3</td></tr>
                            <tr><td>New Sphere</td><td>10</td></tr>
                            <tr><td>Attribute</td><td>Current Rating x 4</td></tr>
                            <tr><td>Ability</td><td>Current Rating x 2</td></tr>
                            <tr><td>Sphere</td><td>Current Rating x 7</td></tr>
                            <tr><td>Arete</td><td>Current Rating x 8</td></tr>
                            <tr><td>Willpower</td><td>Current Rating x 1</td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">üî• Feat Magnitude</div>
                    <div class="acc-content">
                        <table>
                            <tr><th>Suc</th><th>Feat Level</th></tr>
                            <tr><td>1</td><td>Simple (Flash of light)</td></tr>
                            <tr><td>2</td><td>Standard (Heal self)</td></tr>
                            <tr><td>3</td><td>Difficult (Teleport)</td></tr>
                            <tr><td>4-5</td><td>Impressive (Throw car)</td></tr>
                            <tr><td>10+</td><td>Godlike (Nuke)</td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">‚¨ÜÔ∏è Stat Boost Rules</div>
                    <div class="acc-content" style="padding:16px; font-size:0.9rem; line-height:1.6; color:#ccc;">
                        <p><strong style="color:var(--accent)">Base Cost:</strong> 3 Successes per Dot.</p>
                        <p><strong style="color:var(--success)">Spheres:</strong> Life 3 (Physical) / Mind 3 (Mental/Social).</p>
                        <p><strong style="color:var(--danger)">Limit:</strong> Attributes above 5 are Vulgar & cause Pattern Bleeding if not permanent.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-tools" class="tab-page active">
            
            <div class="sub-nav">
                <button class="sub-nav-btn active" onclick="switchSubTab('sub-ritual', this)">üé¥ Ritualmatic</button>
                <button class="sub-nav-btn" onclick="switchSubTab('sub-gens', this)">‚ö° GM Generators</button>
            </div>

            <div id="sub-ritual" class="sub-tab-content active">
                <div class="rit-container">
                    
                    <div class="rit-header">
                        <h1 class="rit-title">Ozan's Ritualmatic</h1>
                        <button class="btn-reset" onclick="resetAll()" data-title="Reset" data-desc="Clears all settings." data-ref="UI">RESET ALL</button>
                    </div>

                    <div class="mode-switch">
                        <div class="mode-opt active" id="btn-m-inst" onclick="mode('instant')" 
                                data-title="Instant Casting" data-desc="Single roll attempt. Results are immediate." data-ref="M20 p.538">Instant</div>
                        <div class="mode-opt" id="btn-m-rit" onclick="mode('ritual')" 
                                data-title="Ritual Casting" data-desc="Extended roll over time. Accumulate successes." data-ref="M20 p.538">Ritual</div>
                    </div>

                    <div class="hud-grid">
                        <div class="hud-box" 
                             data-title="Final Difficulty" data-desc="Calculated Base + GM Override. Click number to edit." data-ref="M20 p.536">
                            <span class="hud-lbl">Difficulty</span>
                            <input type="number" id="disp-diff" class="hud-val val-diff" value="6" onchange="manualOverride('diff')">
                        </div>
                        <div class="hud-box" 
                             data-title="Goal Successes" data-desc="Total cost of Duration, Area, Damage, etc. Click to Edit." data-ref="M20 p.502">
                            <span class="hud-lbl">Goal Successes</span>
                            <input type="number" id="disp-goal" class="hud-val val-goal" value="1" onchange="manualOverride('goal')">
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header"><span class="ph-title">Parameters</span></div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Highest Sphere" data-desc="Base Diff = Level + 3. Cannot exceed Arete." data-ref="M20 p.328">Highest Sphere</label>
                            <div class="counter">
                                <button class="btn-cnt" onclick="mod('sphere', -1)">-</button>
                                <div class="cnt-display" id="val-sphere">3</div>
                                <button class="btn-cnt" onclick="mod('sphere', 1)">+</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Reality" data-desc="Coincidental (+3), Vulgar (+4), Witnessed (+5)." data-ref="M20 p.536">Reality Effect</label>
                            <select id="sel-reality" class="rit-select" onchange="calc()">
                                <option value="3">Coincidental (+3)</option>
                                <option value="4">Vulgar (+4)</option>
                                <option value="5">Witness (+5)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Speed" data-desc="Fast (+1 Diff), Slow (-1 Diff)." data-ref="M20 p.536">Casting Speed</label>
                            <select id="sel-speed" class="rit-select" onchange="calc()">
                                <option value="0">Normal</option>
                                <option value="-1">Slow / Aiming (-1)</option>
                                <option value="1">Fast / Rush (+1)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label class="rit-label">Bonuses (Max -3 Cap)</label>
                            <div class="tools-grid" style="grid-template-columns: repeat(3, 1fr);">
                                <div class="btn-tool" id="btn-sanctum" onclick="tog('sanctum')" 
                                     data-title="Sanctum" data-desc="-1 Diff within Sanctum/Node." data-ref="M20 p.536">üè∞ Sanct</div>
                                <div class="btn-tool" id="btn-inst" onclick="tog('inst')" 
                                     data-title="Instrument" data-desc="-1 Diff for personalized Focus." data-ref="M20 p.536">üîÆ Focus</div>
                                <div class="btn-tool" id="btn-res" onclick="tog('res')" 
                                     data-title="Research" data-desc="-1 Diff for Library use." data-ref="M20 p.536">üìö Lib</div>
                                <div class="btn-tool" id="btn-quint" onclick="tog('quint')" 
                                     data-title="Quintessence" data-desc="-1 Diff per point spent." data-ref="M20 p.536">‚ú® Quint</div>
                                 <div class="btn-tool" id="btn-team" onclick="tog('team')" 
                                     data-title="Teamwork" data-desc="-1 Diff for Assistants." data-ref="M20 p.541">ü§ù Team</div>
                                <div class="btn-tool" id="btn-syn" onclick="tog('syn')" 
                                     data-title="Synergy" data-desc="-1 Diff for Resonant Synergy." data-ref="M20 p.536">‚òØÔ∏è Syn</div>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" style="color:var(--danger)">Penalties (Uncapped)</label>
                            <div class="tools-grid">
                                <div class="btn-tool neg" id="btn-notool" onclick="tog('notool')" 
                                     data-title="No Tools" data-desc="+3 Diff for working without Instruments." data-ref="M20 p.536">üö´ No Tools</div>
                                <div class="btn-tool neg" id="btn-discord" onclick="tog('discord')" 
                                     data-title="Discord" data-desc="+1 Diff for Resonant Discord." data-ref="M20 p.536">‚ö° Discord</div>
                            </div>
                            <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
                                <label class="rit-label" style="flex:1; color:var(--danger)" data-title="Distraction" data-desc="+1 Diff per level of distraction." data-ref="M20 p.536">Distraction (+)</label>
                                <div class="counter" style="flex:1; height:40px; border-color:rgba(248, 113, 113, 0.3)">
                                    <button class="btn-cnt" onclick="mod('distract', -1)">-</button>
                                    <div class="cnt-display" id="val-distract" style="color:var(--danger)">0</div>
                                    <button class="btn-cnt" onclick="mod('distract', 1)">+</button>
                                </div>
                            </div>
                        </div>

                        <div style="border-top:1px dashed var(--border); padding-top:16px; display:grid; grid-template-columns: 1fr 1fr 0.5fr; gap:12px; align-items:end;">
                            
                            <div class="input-group">
                                <label class="rit-label" data-title="Arete" data-desc="Magical enlightenment & Dice Pool." data-ref="M20 p.328">Arete</label>
                                <select id="arete" class="rit-select" onchange="lim()"><option>2</option><option>3</option><option selected>4</option><option>5</option><option>6</option><option>7</option><option>8</option></select>
                            </div>

                            <div class="input-group">
                                <label class="rit-label" data-title="Willpower" data-desc="Determines Ritual Roll Limit." data-ref="M20 p.540">Willpower</label>
                                <select id="will" class="rit-select" onchange="lim()"><option>3</option><option>4</option><option selected>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select>
                            </div>

                            <div class="input-group">
                                <label class="rit-label" style="text-align:center;" data-title="Specialty" data-desc="10s explode on Arete roll." data-ref="Rule">Spec</label>
                                <div id="btn-spec" class="btn-square" onclick="togSpec()">
                                    <div class="btn-square-inner"></div>
                                </div>
                            </div>

                        </div>
                        
                        <div style="text-align:center; font-size:0.75rem; color:var(--text-muted); padding-top:4px;">Limit: <strong id="val-limit" style="color:#fff">9</strong> Rolls</div>

                        <div class="btn-safety" id="toggle-safety" onclick="tog('pauseOnDiff')"
                             data-title="Safety Protocol" data-desc="Automatically pause Ritual if Difficulty increases due to failure." data-ref="UX Feature">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 2L2 22h20L12 2zm0 4l6 14H6L12 6zm-1 10h2v2h-2v-2zm0-6h2v4h-2v-4z" />
                            </svg>
                            <span>Pause on Diff +</span>
                        </div>

                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <span class="ph-title" style="color:var(--success)">Goal & Feats</span>
                            <div class="btn-tool" id="btn-hb" onclick="tog('hb')" style="padding: 6px 12px; font-size:0.7rem;"
                                 data-title="Homebrew Rule" data-desc="Use 1/2/4/6 scale instead of 1/2/3/4." data-ref="House Rule">üè† Homebrew</div>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Duration" data-desc="Base success cost for time." data-ref="M20 p.504">Duration</label>
                            <select id="sel-dur" class="rit-select" onchange="calc()">
                                <option value="0">One Scene (approx. 1 Hour)</option>
                                <option value="1">One Day (24 Hours)</option>
                                <option value="2">One Story (Chapter/Arc)</option>
                                <option value="3">Six Months</option>
                                <option value="4">Permanent (Burn WP/Quint)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Targets" data-desc="Cost for area/targets." data-ref="M20 p.504">Target / Area</label>
                            <select id="sel-targ" class="rit-select" onchange="calc()">
                                <option value="0">1 Target / Self (Touch)</option>
                                <option value="1">2-4 Ppl / ~5m Radius (+1)</option>
                                <option value="2">5-10 Ppl / ~10m Radius (+2)</option>
                                <option value="3">Mass / Building (+3)</option>
                            </select>
                        </div>

                        <div class="slider-card" data-title="Damage Effect" data-desc="1 Success buys 2 Levels of Damage." data-ref="M20 p.504">
                            <div class="slider-header">
                                <div>
                                    <label class="rit-label" style="margin:0; display:inline;">DAMAGE</label>
                                    <select id="sel-dmg-type" onchange="calc()" class="mini-sel">
                                        <option value="Lethal" style="color:var(--warning)">Lethal</option>
                                        <option value="Bashing" style="color:var(--accent)">Bashing</option>
                                        <option value="Aggravated" style="color:var(--danger)">Aggravated</option>
                                    </select>
                                </div>
                                <div style="text-align:right; line-height:1;">
                                    <div class="slider-val" id="txt-dmg">0 Levels</div>
                                    <div class="slider-cost" id="cost-dmg">+0 Suc</div>
                                </div>
                            </div>
                            <input type="range" id="rng-dmg" min="0" max="20" value="0" oninput="calc()">
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Combo / Complexity" data-desc="Add +1 Success per extra Sphere or Feat." data-ref="M20 p.503">Other Feats / Combo</label>
                            <div class="counter">
                                <button class="btn-cnt" onclick="mod('extra', -1)">-</button>
                                <div class="cnt-display" id="val-extra">0</div>
                                <button class="btn-cnt" onclick="mod('extra', 1)">+</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" style="color:var(--danger)" data-title="Opposition" data-desc="+1 Goal per opposing success/threshold." data-ref="M20 p.532">Opposition / Threshold</label>
                            <div class="counter" style="border-color:rgba(248, 113, 113, 0.3)">
                                <button class="btn-cnt" onclick="mod('resist', -1)">-</button>
                                <div class="cnt-display" id="val-resist" style="color:var(--danger)">0</div>
                                <button class="btn-cnt" onclick="mod('resist', 1)">+</button>
                            </div>
                        </div>
                    </div>

                    <button id="btn-cast" class="btn-cast style-inst" onclick="cast()">Cast Instant Spell</button>

                    <div id="log-container">
                        <div class="log-head">
                            <span id="log-title">Result</span> <span id="prog-txt"></span>
                        </div>
                        <div class="prog-bg"><div class="prog-fill" id="p-bar"></div></div>
                        <div class="log-scroll" id="logs"></div>
                    </div>
                </div>
            </div>

            <div id="sub-gens" class="sub-tab-content">
                <div class="gen-section">
                    <div class="tools-grid">
                        <div class="control-panel" style="grid-column: span 2;">
                            <label class="rit-label">QUICK DICE ROLLER</label>
                            <div style="display:flex; gap:10px; margin-top:10px; justify-content: center;">
                                <input type="number" id="q-pool" placeholder="Pool" value="6" class="gen-input">
                                <input type="number" id="q-diff" placeholder="Diff" value="6" class="gen-input">
                                <button class="gen-btn" style="width: auto; margin:0; background:var(--primary); color:#fff; padding: 0 24px;" onclick="quickRoll()">ROLL</button>
                            </div>
                            <div id="q-res" class="gen-res" style="font-size:1.4rem; margin-top:20px;">-</div>
                        </div>

                        <div class="control-panel">
                            <label class="rit-label">INSTANT NPC</label>
                            <button class="gen-btn" onclick="genNPC()">GENERATE</button>
                            <div id="res-npc" class="gen-res">...</div>
                        </div>

                        <div class="control-panel">
                            <label class="rit-label">RESONANCE</label>
                            <button class="gen-btn" onclick="genRes()">GENERATE</button>
                            <div id="res-rez" class="gen-res">...</div>
                        </div>

                        <div class="control-panel" style="grid-column: span 2;">
                            <label class="rit-label" style="color:var(--danger)">PARADOX FLAW</label>
                            <button class="gen-btn" style="border-color:var(--danger); color:var(--danger);" onclick="genFlaw()">SPARK CHAOS</button>
                            <div id="res-flaw" class="gen-res" style="color:#fff; font-weight:400;">...</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

<script>
    /**
     * ==========================================
     * MAGE ENGINE: MVC ARCHITECTURE (PATCHED v1.2)
     * Fix: Specialty Button Logic & Visuals Restored
     * ==========================================
     */

    // --- UTILITIES ---
    function switchTab(tabId, btn) {
        document.querySelectorAll('.tab-page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    function switchSubTab(tabId, btn) {
        document.querySelectorAll('.sub-tab-content').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.sub-nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    function toggleAcc(header) { header.parentElement.classList.toggle('open'); }

    function filterContent() {
        let input = document.getElementById('searchBox').value.toLowerCase();
        document.querySelectorAll('.card, .data-row').forEach(item => {
            let text = item.innerText.toLowerCase();
            if (item.getAttribute('data-search')) text += " " + item.getAttribute('data-search').toLowerCase();
            if (text.includes(input)) {
                item.style.display = "";
                if (item.classList.contains('data-row')) item.closest('.acc-item').classList.add('open');
            } else item.style.display = "none";
        });
    }

    // --- STATE MANAGEMENT ---
    const s = { 
        mode: 'instant', sphere: 3, extra: 0, resist: 0, gmDiff: 0, gmGoal: 0, 
        sanctum: false, inst: false, res: false, quint: false, team: false, 
        syn: false, notool: false, discord: false, distract: 0, hb: false, 
        pauseOnDiff: false, spec: false 
    };

    let activeTimer = null;
    let ritState = { totalSuc: 0, turn: 0, currentDiff: 6, isPaused: false, hasStarted: false };

    // --- ERROR & TOOLTIP ---
    const errorModal = document.getElementById('error-modal');
    function showError(msg) { errorModal.style.display = 'flex'; }
    function closeError() { errorModal.style.display = 'none'; }

    const tt = document.getElementById('tooltip');
    const ttT = tt.querySelector('.tt-title');
    const ttD = tt.querySelector('.tt-desc');
    const ttR = tt.querySelector('.tt-ref');

    document.querySelectorAll('[data-title]').forEach(el => {
        el.addEventListener('mousemove', e => {
            tt.style.display = 'block';
            let x = e.clientX + 15, y = e.clientY + 15;
            if (x + 280 > window.innerWidth) x = e.clientX - 295;
            tt.style.left = x + 'px'; tt.style.top = y + 'px';
            if (ttT.innerText !== el.dataset.title) {
                ttT.innerText = el.dataset.title; 
                ttD.innerText = el.dataset.desc; 
                ttR.innerText = el.dataset.ref;
            }
        });
        el.addEventListener('mouseleave', () => tt.style.display = 'none');
    });

    // --- CORE LOGIC ---
    function resetAll() {
        if (activeTimer) { clearInterval(activeTimer); activeTimer = null; }
        Object.assign(s, { 
            mode: 'instant', sphere: 3, extra: 0, resist: 0, gmDiff: 0, gmGoal: 0, 
            sanctum: false, inst: false, res: false, quint: false, team: false, 
            syn: false, notool: false, discord: false, distract: 0, hb: false, 
            pauseOnDiff: false, spec: false 
        });
        
        // Reset Inputs
        document.getElementById('sel-reality').value = '3';
        document.getElementById('sel-speed').value = '0';
        document.getElementById('sel-dur').value = '0';
        document.getElementById('sel-targ').value = '0';
        document.getElementById('rng-dmg').value = 0;
        document.getElementById('sel-dmg-type').value = 'Lethal';
        document.getElementById('arete').value = '4';
        document.getElementById('will').value = '5';
        
        document.querySelectorAll('.btn-tool, .btn-hb, .btn-safety').forEach(b => b.classList.remove('active'));
        
        // Fix: Spec button visual reset (Using new ID)
        document.getElementById('btn-spec').classList.remove('checked');
        
        document.getElementById('val-sphere').textContent = '3';
        document.getElementById('val-extra').textContent = '0';
        document.getElementById('val-resist').textContent = '0';
        document.getElementById('val-distract').textContent = '0';
        document.getElementById('log-container').style.display = 'none';
        
        ritState = { totalSuc: 0, turn: 0, currentDiff: 6, isPaused: false, hasStarted: false };
        mode('instant'); 
        calc(); 
        lim();
    }

    function mode(modeName) {
        if (activeTimer) { clearInterval(activeTimer); activeTimer = null; }
        s.mode = modeName;
        document.getElementById('btn-m-inst').className = modeName === 'instant' ? 'mode-opt active' : 'mode-opt';
        document.getElementById('btn-m-rit').className = modeName === 'ritual' ? 'mode-opt active' : 'mode-opt';
        updateButtonState();
    }

    function updateButtonState() {
        let btn = document.getElementById('btn-cast');
        if (s.mode === 'instant') {
            btn.textContent = "CAST INSTANT SPELL"; 
            btn.className = "btn-cast style-inst";
        } else {
            if (ritState.isPaused) {
                btn.textContent = "CONTINUE RITUAL";
                btn.className = "btn-cast style-pause";
            } else {
                btn.textContent = "BEGIN RITUAL";
                btn.className = "btn-cast style-rit";
            }
        }
    }

    function mod(key, value) {
        s[key] += value;
        if (key === 'sphere') { 
            if (s[key] < 1) s[key] = 1; 
            if (s[key] > 9) s[key] = 9; 
        }
        if ((key === 'extra' || key === 'resist' || key === 'distract') && s[key] < 0) s[key] = 0;
        
        const el = document.getElementById('val-' + key);
        if (el) el.textContent = s[key];
        calc();
    }

    function tog(key) {
        s[key] = !s[key];
        let id = key === 'hb' ? 'btn-hb' : (key === 'pauseOnDiff' ? 'toggle-safety' : 'btn-' + key);
        let el = document.getElementById(id);
        
        if (key === 'notool' && s[key]) { s.inst = false; document.getElementById('btn-inst').classList.remove('active'); }
        if (key === 'inst' && s[key]) { s.notool = false; document.getElementById('btn-notool').classList.remove('active'); }
        
        if (s[key]) el.classList.add('active'); else el.classList.remove('active');
        calc();
    }

    // --- FIX: BUTTON TARGETING CORRECTED ---
    function togSpec() {
        s.spec = !s.spec;
        // Targeting new ID for CSS class toggle
        let el = document.getElementById('btn-spec'); 
        if (s.spec) el.classList.add('checked'); else el.classList.remove('checked');
    }

    function lim() {
        let a = parseInt(document.getElementById('arete').value);
        let w = parseInt(document.getElementById('will').value);
        document.getElementById('val-limit').textContent = a + w;
    }

    function getBaseValues() {
        let sph = parseInt(document.getElementById('val-sphere').textContent);
        let real = parseInt(document.getElementById('sel-reality').value);
        let spd = parseInt(document.getElementById('sel-speed').value);
        
        let bon = (s.sanctum ? 1 : 0) + (s.inst ? 1 : 0) + (s.res ? 1 : 0) + (s.quint ? 1 : 0) + (s.team ? 1 : 0) + (s.syn ? 1 : 0);
        if (bon > 3) bon = 3; 

        let pen = (s.notool ? 3 : 0) + (s.discord ? 1 : 0) + s.distract;
        let baseDiff = sph + real + spd - bon + pen;
        let floor = Math.max(3, sph);
        
        baseDiff = Math.max(floor, Math.min(baseDiff, 10));

        let durIdx = parseInt(document.getElementById('sel-dur').value);
        let durCosts = s.hb ? [1, 2, 4, 6, 10] : [1, 2, 3, 4, 6];
        let baseDur = durCosts[durIdx];
        
        let targ = parseInt(document.getElementById('sel-targ').value);
        let dmg = parseInt(document.getElementById('rng-dmg').value);
        let dmgC = Math.ceil(dmg / 2);
        
        let baseGoal = Math.max(1, baseDur + targ + dmgC + s.extra + s.resist);

        return { diff: baseDiff, goal: baseGoal };
    }

    function calc() {
        let base = getBaseValues();
        
        let dmg = parseInt(document.getElementById('rng-dmg').value);
        let dmgT = document.getElementById('sel-dmg-type').value;
        let dCol = dmgT === "Lethal" ? "var(--warning)" : (dmgT === "Aggravated" ? "var(--danger)" : "var(--accent)");
        let dTxt = document.getElementById('txt-dmg');
        
        dTxt.textContent = `${dmg} ${dmgT}`; 
        dTxt.style.color = dCol;
        document.getElementById('cost-dmg').textContent = `+${Math.ceil(dmg / 2)} Suc`;

        let elDiff = document.getElementById('disp-diff');
        let elGoal = document.getElementById('disp-goal');

        elDiff.value = base.diff + s.gmDiff;
        elGoal.value = base.goal + s.gmGoal;

        if (!ritState.hasStarted) ritState.currentDiff = parseInt(elDiff.value);

        if (s.gmDiff !== 0) elDiff.classList.add('modified'); else elDiff.classList.remove('modified');
        if (s.gmGoal !== 0) elGoal.classList.add('modified'); else elGoal.classList.remove('modified');
    }

    function manualOverride(type) {
        let inputEl = document.getElementById('disp-' + type);
        let rawVal = inputEl.value;
        let base = getBaseValues(); 
        
        if (rawVal === "" || isNaN(parseInt(rawVal))) {
            if (type === 'diff') s.gmDiff = 0; else s.gmGoal = 0;
        } else {
            let userVal = parseInt(rawVal);
            if (type === 'diff') s.gmDiff = userVal - base.diff;
            else s.gmGoal = userVal - base.goal;
        }
        calc(); 
    }

    // --- CASTING ENGINE (SECURE) ---
    function doRoll(pool, diff, spec) {
        let suc = 0, ones = 0, results = [];
        for (let i = 0; i < pool; i++) {
            let d = Math.floor(Math.random() * 10) + 1;
            if (d >= diff) suc++; 
            if (d === 1) ones++;
            
            let val = d;
            let exploded = false;

            if (spec && d === 10) { 
                let x = Math.floor(Math.random() * 10) + 1;
                if (x >= diff) suc++; 
                val = `10+${x}`;
                exploded = true;
            }
            results.push({ val: val, raw: d, hit: d >= diff, botch: d === 1 });
        }
        return { suc, ones, results };
    }

    function addLogEntry(turn, diff, rollData, msg, type) {
        const entry = document.createElement('div');
        entry.className = `entry ${type}`;
        
        const info = document.createElement('div');
        info.innerHTML = `<b>T${turn}</b> <span style="opacity:0.6">(${diff})</span>`;
        
        const diceSpan = document.createElement('span');
        diceSpan.className = 'dice';
        diceSpan.style.marginLeft = "10px";
        
        rollData.results.forEach(r => {
            const s = document.createElement('span');
            s.textContent = r.val;
            if (r.botch) { s.className = 'd1 hl-red'; }
            else if (r.hit && !r.botch) { s.className = 'suc hl-green'; }
            else { s.style.color = 'var(--text-muted)'; }
            s.style.marginRight = "4px";
            diceSpan.appendChild(s);
        });
        
        const msgDiv = document.createElement('b');
        msgDiv.textContent = msg;
        
        info.appendChild(diceSpan);
        entry.appendChild(info);
        entry.appendChild(msgDiv);
        
        const logs = document.getElementById('logs');
        logs.insertBefore(entry, logs.firstChild);
    }

    function addSystemMsg(txt, win) {
        const div = document.createElement('div');
        let c = win ? "var(--success)" : "var(--text-muted)";
        div.style.cssText = `text-align:center; padding:10px; margin-bottom:10px; border:2px solid ${c}; color:${c}; border-radius:8px; font-weight:800;`;
        div.textContent = txt;
        const logs = document.getElementById('logs');
        logs.insertBefore(div, logs.firstChild);
    }

    function cast() {
        let currentSphere = parseInt(document.getElementById('val-sphere').textContent);
        let currentArete = parseInt(document.getElementById('arete').value);
        
        if (currentSphere > currentArete) { showError("Invalid Cast"); return; }

        if (activeTimer) { clearInterval(activeTimer); activeTimer = null; }
        document.getElementById('log-container').style.display = 'block';
        
        let arete = parseInt(document.getElementById('arete').value);
        let goal = parseInt(document.getElementById('disp-goal').value);
        let limit = parseInt(document.getElementById('val-limit').textContent);

        // INSTANT MODE
        if (s.mode === 'instant') {
            document.getElementById('log-title').textContent = "Instant Result";
            document.getElementById('prog-txt').textContent = "";
            document.getElementById('p-bar').style.width = "0%";
            document.getElementById('logs').innerHTML = ""; 
            
            let diff = parseInt(document.getElementById('disp-diff').value);
            let res = doRoll(arete, diff, s.spec);
            let net = res.suc - res.ones;
            let type = "fail", msg = "";

            if (res.suc === 0 && res.ones > 0) { type = "botch"; msg = `BOTCH! (${res.ones} Pdx)`; } 
            else if (net < 1) { msg = "FAILED"; } 
            else if (net < goal) { msg = `WEAK (${net}/${goal} Suc)`; } 
            else { type = "success"; msg = `SUCCESS! (${net} Suc)`; }
            
            addLogEntry(1, diff, res, msg, type);
            return;
        }

        // RITUAL MODE
        document.getElementById('log-title').textContent = "Ritual Progress";
        if (!ritState.isPaused) {
            document.getElementById('logs').innerHTML = ""; 
            ritState.totalSuc = 0; 
            ritState.turn = 0;
            ritState.currentDiff = parseInt(document.getElementById('disp-diff').value);
            ritState.hasStarted = true;
        } else {
            ritState.isPaused = false;
            updateButtonState();
        }

        document.getElementById('prog-txt').textContent = `${ritState.totalSuc} / ${goal}`;
        document.getElementById('p-bar').style.width = (ritState.totalSuc / goal * 100) + "%";

        activeTimer = setInterval(() => {
            ritState.turn++;
            let res = doRoll(arete, ritState.currentDiff, s.spec);
            let net = res.suc - res.ones;
            let type = "", msg = "";
            let diffIncreased = false;

            if (res.suc === 0 && res.ones > 0) {
                clearInterval(activeTimer); activeTimer = null;
                let pdx = ritState.totalSuc + res.ones;
                msg = `BOTCH! (${pdx} Pdx)`; 
                addSystemMsg("BACKLASH - RITUAL FAILED", false);
                type = "botch";
                ritState = { totalSuc: 0, turn: 0, currentDiff: 6, isPaused: false, hasStarted: false };
                updateButtonState();
            } else {
                if (net <= 0) {
                    type = "fail"; 
                    if (net < 0) { 
                        ritState.totalSuc += net; 
                        if (ritState.totalSuc < 0) ritState.totalSuc = 0; 
                        msg = `Fail (${net})`; 
                    } else { 
                        msg = "Fail (0). Diff +1"; 
                    }
                    if (ritState.currentDiff < 10) { ritState.currentDiff++; diffIncreased = true; }
                } else {
                    type = "success"; 
                    ritState.totalSuc += net; 
                    msg = `+${net} Suc`;
                }
            }
            
            if (type) { 
                addLogEntry(ritState.turn, diffIncreased ? ritState.currentDiff - 1 : ritState.currentDiff, res, msg, type);
                
                let pct = (ritState.totalSuc / goal) * 100; 
                if (pct > 100) pct = 100;
                document.getElementById('p-bar').style.width = pct + "%";
                document.getElementById('prog-txt').textContent = `${ritState.totalSuc} / ${goal}`;

                // PAUSE
                if (diffIncreased && s.pauseOnDiff && ritState.totalSuc < goal) {
                    clearInterval(activeTimer); activeTimer = null;
                    ritState.isPaused = true;
                    updateButtonState();
                    addSystemMsg(`PAUSED (Diff Increased to ${ritState.currentDiff})`, false);
                    return;
                }

                // WIN
                if (ritState.totalSuc >= goal) { 
                    clearInterval(activeTimer); activeTimer = null; 
                    addSystemMsg("RITUAL COMPLETE", true);
                    ritState = { totalSuc: 0, turn: 0, currentDiff: 6, isPaused: false, hasStarted: false }; 
                    updateButtonState();
                } 
                // EXHAUST
                else if (ritState.turn >= limit) { 
                    clearInterval(activeTimer); activeTimer = null; 
                    addSystemMsg("EXHAUSTED (Willpower Limit)", false);
                    ritState = { totalSuc: 0, turn: 0, currentDiff: 6, isPaused: false, hasStarted: false }; 
                    updateButtonState();
                }
            }
        }, 600);
    }

    // --- GENERATORS ---
    const npcRoles = ["Techno-Hacker", "Hermit", "Corporate Mage", "Street Shaman", "Necromancer", "Hitman", "Cultist", "Detective", "Spirit Guide"];
    const npcTraits = ["Paranoid", "Arrogant", "Helpful", "Cryptic", "Aggressive", "Sleepy", "Fanatical", "Charming"];
    function genNPC() { document.getElementById('res-npc').textContent = `${npcTraits[Math.floor(Math.random()*npcTraits.length)]} ${npcRoles[Math.floor(Math.random()*npcRoles.length)]}`; }
    
    const resonances = ["Fiery (Dynamic)", "Cold (Stasis)", "Rotting (Entropic)", "Holy (Sacred)", "Industrial (Tech)", "Wild (Primal)", "Empty (Static)"];
    function genRes() { document.getElementById('res-rez').textContent = resonances[Math.floor(Math.random()*resonances.length)]; }

    const flaws = ["Clocks run backwards", "Shadows detach", "Echoing voice", "Tech glitch", "Milk sours", "Temperature drop", "Sulfur smell", "Animals panic"];
    function genFlaw() { document.getElementById('res-flaw').textContent = flaws[Math.floor(Math.random()*flaws.length)]; }

    function quickRoll() {
        let p = parseInt(document.getElementById('q-pool').value) || 1;
        let d = parseInt(document.getElementById('q-diff').value) || 6;
        let suc = 0, ones = 0;
        for (let i = 0; i < p; i++) { 
            let r = Math.floor(Math.random() * 10) + 1; 
            if (r >= d) suc++; 
            if (r === 1) ones++; 
        }
        let net = suc - ones;
        let el = document.getElementById('q-res');
        if (suc === 0 && ones > 0) { el.textContent = "BOTCH!"; el.style.color = "var(--danger)"; }
        else if (net < 0) { el.textContent = "FAIL"; el.style.color = "var(--text-muted)"; }
        else { el.textContent = `${net} SUCCESSES`; el.style.color = "var(--success)"; }
    }

    // Init
    calc(); 
    lim();
</script>
</body>
</html>
