<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAGE 20TH: Secret Library</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Montserrat:wght@500;600;700;800;900&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css?time=1">
</head>
<body>

    <div class="hero-header">
        <div class="brand-container">
            <h1 class="brand-title">MAGE 20TH: SECRET LIBRARY</h1>
            <div class="brand-subtitle">Reality Alteration Protocols v2.0</div>
        </div>

        <div class="search-container">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" id="searchBox" class="search-bar" placeholder="Search Rotes, Rules, Spheres..." onkeyup="filterContent()">
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-btn" onclick="switchTab('tab-spheres', this)">🔮 Spheres</button>
        <button class="nav-btn" onclick="switchTab('tab-rotes', this)">📚 Rotes</button>
        <button class="nav-btn" onclick="switchTab('tab-rules', this)">⚖️ Rules</button>
        <button class="nav-btn" onclick="switchTab('tab-merits', this)">⚖️ Merits</button>
        <button class="nav-btn active" onclick="switchTab('tab-tools', this)">🎲 Tools</button>
    </div>

    <div class="content-area">

        <div id="tooltip">
            <span class="tt-title"></span>
            <span class="tt-desc"></span>
            <span class="tt-ref"></span>
        </div>

        <div id="error-modal">
            <div class="modal-box">
                <div class="modal-title">⚠ Rule Violation</div>
                <div class="modal-text">Your Sphere rating cannot exceed your Arete rating.</div>
                <div class="tt-ref" style="margin-bottom:15px;">Reference: M20 Core Rulebook, p.251</div>
                <button class="modal-btn" onclick="closeError()">UNDERSTOOD</button>
            </div>
        </div>

        <div id="tab-spheres" class="tab-page">
            <div class="grid-3">
                <div class="card">
                    <span class="card-title">🌐 Correspondence</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="Immediate spatial perception and orientation." data-ref="M20 QS p.19"><span>1</span> Immediate Spatial Perception</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Sense and touch space; minor warding." data-ref="M20 QS p.19"><span>2</span> Sense & Touch Space</li>
                        <li data-title="Rank 3: Control" data-desc="Pierce space; teleportation and perception." data-ref="M20 QS p.19"><span>3</span> Pierce Space / Teleport</li>
                        <li data-title="Rank 4: Command" data-desc="Rend space; co-location and gateways." data-ref="M20 QS p.19"><span>4</span> Rend Space / Co-location</li>
                        <li data-title="Rank 5: Mastery" data-desc="Mutate space; distort distances and volumes." data-ref="M20 QS p.19"><span>5</span> Mutate Space / Distort</li>
                    </ul>
                </div>

                <div class="card">
                    <span class="card-title">🎲 Entropy</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="Sense fate, flaws, and probability currents." data-ref="M20 QS p.19"><span>1</span> Sense Fate & Flaws</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Control probability and minor fortune." data-ref="M20 QS p.19"><span>2</span> Control Probability</li>
                        <li data-title="Rank 3: Control" data-desc="Affect predictable matter and energy patterns." data-ref="M20 QS p.19"><span>3</span> Affect Matter & Energy</li>
                        <li data-title="Rank 4: Command" data-desc="Affect life cycles; induce rapid decay." data-ref="M20 QS p.19"><span>4</span> Affect Life / Decay</li>
                        <li data-title="Rank 5: Mastery" data-desc="Affect thought, concepts, and abstract ideas." data-ref="M20 QS p.19"><span>5</span> Affect Thought / Concepts</li>
                    </ul>
                </div>

                <div class="card">
                    <span class="card-title">⚡ Forces</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="Perceive energy currents and forces." data-ref="M20 QS p.19"><span>1</span> Perceive Energy</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Control minor forces; alter direction/quality." data-ref="M20 QS p.19"><span>2</span> Control Minor Forces</li>
                        <li data-title="Rank 3: Control" data-desc="Transmute minor forces; conjure energy." data-ref="M20 QS p.19"><span>3</span> Transmute Minor Forces</li>
                        <li data-title="Rank 4: Command" data-desc="Control major forces; weather and storms." data-ref="M20 QS p.19"><span>4</span> Control Major Forces</li>
                        <li data-title="Rank 5: Mastery" data-desc="Forces mastery; summon cataclysms." data-ref="M20 QS p.19"><span>5</span> Mastery / Cataclysm</li>
                    </ul>
                </div>

                <div class="card">
                    <span class="card-title">🧬 Life</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="Sense life, health, and biological patterns." data-ref="M20 QS p.19"><span>1</span> Sense Life & Health</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Alter simple life forms; heal self." data-ref="M20 QS p.19"><span>2</span> Alter Simple / Self</li>
                        <li data-title="Rank 3: Control" data-desc="Transform self; heal others; alter simple life." data-ref="M20 QS p.19"><span>3</span> Transform Self / Simple</li>
                        <li data-title="Rank 4: Command" data-desc="Transform complex life forms; major alterations." data-ref="M20 QS p.19"><span>4</span> Transform Complex Forms</li>
                        <li data-title="Rank 5: Mastery" data-desc="Create complex life; perfect metamorphosis." data-ref="M20 QS p.19"><span>5</span> Create Life / Perfect</li>
                    </ul>
                </div>

                <div class="card">
                    <span class="card-title">🧱 Matter</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="Analyze substance structures and properties." data-ref="M20 QS p.19"><span>1</span> Matter Perception</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Transmute basic homogeneous substances." data-ref="M20 QS p.19"><span>2</span> Basic Transmutation</li>
                        <li data-title="Rank 3: Control" data-desc="Alter form and shape; conjure solid matter." data-ref="M20 QS p.19"><span>3</span> Alter Form & Shape</li>
                        <li data-title="Rank 4: Command" data-desc="Complex transformations; alter properties." data-ref="M20 QS p.19"><span>4</span> Complex Transformation</li>
                        <li data-title="Rank 5: Mastery" data-desc="Create or destroy matter; impossible materials." data-ref="M20 QS p.19"><span>5</span> Create / Destroy Matter</li>
                    </ul>
                </div>

                <div class="card">
                    <span class="card-title">🧠 Mind</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="Sense thoughts, emotions, and resonance." data-ref="M20 QS p.19"><span>1</span> Sense Thought & Emotion</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Read surface thoughts; influence moods." data-ref="M20 QS p.19"><span>2</span> Read Surface / Impulse</li>
                        <li data-title="Rank 3: Control" data-desc="Mental link; dreamwalk; psychic assault." data-ref="M20 QS p.19"><span>3</span> Mental Link / Dreamwalk</li>
                        <li data-title="Rank 4: Command" data-desc="Control conscious mind; alter memories." data-ref="M20 QS p.19"><span>4</span> Control Conscious Mind</li>
                        <li data-title="Rank 5: Mastery" data-desc="Control subconscious; rewrite personality." data-ref="M20 QS p.19"><span>5</span> Control Subconscious</li>
                    </ul>
                </div>

                <div class="card">
                    <span class="card-title">✨ Prime</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="Sense Quintessence and magic use." data-ref="M20 QS p.19"><span>1</span> Sense Quintessence</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Fuel patterns; enchant weapons; body of light." data-ref="M20 QS p.19"><span>2</span> Fuel Pattern / Enchant</li>
                        <li data-title="Rank 3: Control" data-desc="Channel/extract energy from Tass/Nodes." data-ref="M20 QS p.19"><span>3</span> Channel / Extract Energy</li>
                        <li data-title="Rank 4: Command" data-desc="Expel energy from patterns; siphon power." data-ref="M20 QS p.19"><span>4</span> Expel / Siphon Energy</li>
                        <li data-title="Rank 5: Mastery" data-desc="Alter flow; create Node; infuse life." data-ref="M20 QS p.19"><span>5</span> Alter Flow / Create Node</li>
                    </ul>
                </div>

                <div class="card">
                    <span class="card-title">👻 Spirit</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="See spirits and across the Gauntlet." data-ref="M20 QS p.19"><span>1</span> Spirit Sight</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Touch spirits; communicate; minor calls." data-ref="M20 QS p.19"><span>2</span> Touch Spirit</li>
                        <li data-title="Rank 3: Control" data-desc="Step Sideways; harm spirits; waken objects." data-ref="M20 QS p.19"><span>3</span> Step Sideways / Gauntlet</li>
                        <li data-title="Rank 4: Command" data-desc="Rend Gauntlet; bind spirits; create fetish." data-ref="M20 QS p.19"><span>4</span> Rend Gauntlet / Bind</li>
                        <li data-title="Rank 5: Mastery" data-desc="Forge spirits; Gilgul; outer realms." data-ref="M20 QS p.19"><span>5</span> Forge Spirit / Gilgul</li>
                    </ul>
                </div>

                <div class="card">
                    <span class="card-title">⏳ Time</span>
                    <ul class="card-list">
                        <li data-title="Rank 1: Perception" data-desc="Perfect time sense; spot distortions." data-ref="M20 QS p.19"><span>1</span> Time Sense</li>
                        <li data-title="Rank 2: Manipulation" data-desc="Past and future sight (Post/Precognition)." data-ref="M20 QS p.19"><span>2</span> Past & Future Sight</li>
                        <li data-title="Rank 3: Control" data-desc="Distort time; speed up; slow down." data-ref="M20 QS p.19"><span>3</span> Time Distortion / Speed</li>
                        <li data-title="Rank 4: Command" data-desc="Time bubbles; trigger effects." data-ref="M20 QS p.19"><span>4</span> Time Bubble / Trigger</li>
                        <li data-title="Rank 5: Mastery" data-desc="Time travel; time immunity." data-ref="M20 QS p.19"><span>5</span> Time Travel / Immunity</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="tab-rotes" class="tab-page">
            <div class="accordion">

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">⚔️ Combat & Martial Arts</div>
                    <div class="acc-content" id="cat-combat">
                    </div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">🧪 Transmutation & Elements</div>
                    <div class="acc-content" id="cat-transmutation"></div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">🚀 Travel & Time</div>
                    <div class="acc-content" id="cat-travel"></div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">🧠 Mind & Influence</div>
                    <div class="acc-content" id="cat-mind"></div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">👻 Spirit, Necro & Wards</div>
                    <div class="acc-content" id="cat-spirit"></div>
                </div>

            </div>
        </div>

        <div id="tab-rules" class="tab-page">
            <div class="accordion" id="rules-container">
            </div>
        </div>

        <div id="tab-merits" class="tab-page">
            <div class="accordion">

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">💪 Physical Merits</div>
                    <div class="acc-content" id="cat-merit-phys"></div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">🧠 Mental Merits</div>
                    <div class="acc-content" id="cat-merit-ment"></div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">🤝 Social Merits</div>
                    <div class="acc-content" id="cat-merit-soc"></div>
                </div>

                <div class="acc-item">
                    <div class="acc-header" onclick="toggleAcc(this)">✨ Supernatural Merits</div>
                    <div class="acc-content" id="cat-merit-super"></div>
                </div>

                <div class="acc-item" style="border-color:var(--danger);">
                    <div class="acc-header" onclick="toggleAcc(this)" style="color:var(--danger);">⚠️ Flaws (Physical/Mental)</div>
                    <div class="acc-content" id="cat-flaw-phys"></div>
                </div>

                <div class="acc-item" style="border-color:var(--danger);">
                    <div class="acc-header" onclick="toggleAcc(this)" style="color:var(--danger);">🔮 Flaws (Supernatural)</div>
                    <div class="acc-content" id="cat-flaw-super"></div>
                </div>

            </div>
        </div>

        <div id="tab-tools" class="tab-page active">
            <div class="sub-nav">
                <button class="sub-nav-btn active" onclick="switchSubTab('sub-ritual', this)">🎴 Ritualmatic</button>
                <button class="sub-nav-btn" onclick="switchSubTab('sub-gens', this)">⚡ GM Generators</button>
            </div>

            <div id="sub-ritual" class="sub-tab-content active">
                <div class="rit-container">

                    <div class="rit-header">
                        <h1 class="rit-title">Ozan's Ritualmatic</h1>
                        <button class="btn-reset" onclick="resetAll()" data-title="Reset" data-desc="Clears all settings." data-ref="UI">RESET ALL</button>
                    </div>

                    <div class="mode-switch">
                        <div class="mode-opt active" id="btn-m-inst" onclick="setMode('instant')"
                             data-title="Instant Casting" data-desc="Single roll attempt. Results are immediate." data-ref="M20 p.538">Instant</div>
                        <div class="mode-opt" id="btn-m-rit" onclick="setMode('ritual')"
                             data-title="Ritual Casting" data-desc="Extended roll over time. Accumulate successes." data-ref="M20 p.538">Ritual</div>
                    </div>

                    <div class="hud-grid">
                        <div class="hud-box"
                             data-title="Final Difficulty" data-desc="Calculated Base + GM Override. Click number to edit." data-ref="M20 p.536">
                            <span class="hud-lbl">Difficulty</span>
                            <input type="number" id="disp-diff" class="hud-val val-diff" value="6" onchange="manualOverride('diff')">
                        </div>
                        <div class="hud-box"
                             data-title="Goal Successes" data-desc="Total cost of Duration, Area, Damage, etc. Click to Edit." data-ref="M20 p.502">
                            <span class="hud-lbl">Goal Successes</span>
                            <input type="number" id="disp-goal" class="hud-val val-goal" value="1" onchange="manualOverride('goal')">
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header"><span class="ph-title">Parameters</span></div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Highest Sphere" data-desc="Base Diff = Level + 3. Cannot exceed Arete." data-ref="M20 p.328">Highest Sphere</label>
                            <div class="counter">
                                <button class="btn-cnt" onclick="modifyState('sphere', -1)">-</button>
                                <div class="cnt-display" id="val-sphere">3</div>
                                <button class="btn-cnt" onclick="modifyState('sphere', 1)">+</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Reality" data-desc="Coincidental (+3), Vulgar (+4), Witnessed (+5)." data-ref="M20 p.536">Reality Effect</label>
                            <select id="sel-reality" class="rit-select" onchange="recalculate()">
                                <option value="3">Coincidental (+3)</option>
                                <option value="4">Vulgar (+4)</option>
                                <option value="5">Witness (+5)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Speed" data-desc="Fast (+1 Diff), Slow (-1 Diff)." data-ref="M20 p.536">Casting Speed</label>
                            <select id="sel-speed" class="rit-select" onchange="recalculate()">
                                <option value="0">Normal</option>
                                <option value="-1">Slow / Aiming (-1)</option>
                                <option value="1">Fast / Rush (+1)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label class="rit-label">Bonuses (Max -3 Cap)</label>
                            <div class="tools-grid" style="grid-template-columns: repeat(3, 1fr);">
                                <div class="btn-tool" id="btn-sanctum" onclick="toggleState('sanctum')"
                                     data-title="Sanctum" data-desc="-1 Diff within Sanctum/Node." data-ref="M20 p.536">🏰 Sanct</div>
                                <div class="btn-tool" id="btn-inst" onclick="toggleState('inst')"
                                     data-title="Instrument" data-desc="-1 Diff for personalized Focus." data-ref="M20 p.536">🔮 Focus</div>
                                <div class="btn-tool" id="btn-res" onclick="toggleState('res')"
                                     data-title="Research" data-desc="-1 Diff for Library use." data-ref="M20 p.536">📚 Lib</div>
                                <div class="btn-tool" id="btn-quint" onclick="toggleState('quint')"
                                     data-title="Quintessence" data-desc="-1 Diff per point spent." data-ref="M20 p.536">✨ Quint</div>
                                <div class="btn-tool" id="btn-team" onclick="toggleState('team')"
                                     data-title="Teamwork" data-desc="-1 Diff for Assistants." data-ref="M20 p.541">🤝 Team</div>
                                <div class="btn-tool" id="btn-syn" onclick="toggleState('syn')"
                                     data-title="Synergy" data-desc="-1 Diff for Resonant Synergy." data-ref="M20 p.536">☯️ Syn</div>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" style="color:var(--danger)">Penalties (Uncapped)</label>
                            <div class="tools-grid">
                                <div class="btn-tool neg" id="btn-notool" onclick="toggleState('notool')"
                                     data-title="No Tools" data-desc="+3 Diff for working without Instruments." data-ref="M20 p.536">🚫 No Tools</div>
                                <div class="btn-tool neg" id="btn-discord" onclick="toggleState('discord')"
                                     data-title="Discord" data-desc="+1 Diff for Resonant Discord." data-ref="M20 p.536">⚡ Discord</div>
                            </div>
                            <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
                                <label class="rit-label" style="flex:1; color:var(--danger)" data-title="Distraction" data-desc="+1 Diff per level of distraction." data-ref="M20 p.536">Distraction (+)</label>
                                <div class="counter" style="flex:1; height:40px; border-color:rgba(248, 113, 113, 0.3)">
                                    <button class="btn-cnt" onclick="modifyState('distract', -1)">-</button>
                                    <div class="cnt-display" id="val-distract" style="color:var(--danger)">0</div>
                                    <button class="btn-cnt" onclick="modifyState('distract', 1)">+</button>
                                </div>
                            </div>
                        </div>

                        <div style="border-top:1px dashed var(--border); padding-top:16px; display:grid; grid-template-columns: 1fr 1fr 0.5fr; gap:12px; align-items:end;">

                            <div class="input-group">
                                <label class="rit-label" data-title="Arete" data-desc="Magical enlightenment & Dice Pool." data-ref="M20 p.328">Arete</label>
                                <select id="arete" class="rit-select" onchange="updateLimits()"><option>2</option><option>3</option><option selected>4</option><option>5</option><option>6</option><option>7</option><option>8</option></select>
                            </div>

                            <div class="input-group">
                                <label class="rit-label" data-title="Willpower" data-desc="Determines Ritual Roll Limit." data-ref="M20 p.540">Willpower</label>
                                <select id="will" class="rit-select" onchange="updateLimits()"><option>3</option><option>4</option><option selected>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select>
                            </div>

                            <div class="input-group">
                                <label class="rit-label" style="text-align:center;" data-title="Specialty" data-desc="10s explode on Arete roll." data-ref="Rule">Spec</label>
                                <div id="btn-spec" class="btn-square" onclick="toggleSpecialty()">
                                    <div class="btn-square-inner"></div>
                                </div>
                            </div>

                        </div>

                        <div style="text-align:center; font-size:0.75rem; color:var(--text-muted); padding-top:4px;">Limit: <strong id="val-limit" style="color:#fff">9</strong> Rolls</div>

                        <div class="btn-safety" id="toggle-safety" onclick="toggleState('pauseOnDiff')"
                             data-title="Safety Protocol" data-desc="Automatically pause Ritual if Difficulty increases due to failure." data-ref="UX Feature">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 2L2 22h20L12 2zm0 4l6 14H6L12 6zm-1 10h2v2h-2v-2zm0-6h2v4h-2v-4z" />
                            </svg>
                            <span>Pause on Diff +</span>
                        </div>

                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <span class="ph-title" style="color:var(--success)">Goal & Feats</span>
                            <div class="btn-tool" id="btn-hb" onclick="toggleState('hb')" style="padding: 6px 12px; font-size:0.7rem;"
                                 data-title="Homebrew Rule" data-desc="Use 1/2/4/6 scale instead of 1/2/3/4." data-ref="House Rule">🏠 Homebrew</div>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Duration" data-desc="Base success cost for time." data-ref="M20 p.504">Duration</label>
                            <select id="sel-dur" class="rit-select" onchange="recalculate()">
                                <option value="0">One Scene (approx. 1 Hour)</option>
                                <option value="1">One Day (24 Hours)</option>
                                <option value="2">One Story (Chapter/Arc)</option>
                                <option value="3">Six Months</option>
                                <option value="4">Permanent (Burn WP/Quint)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Targets" data-desc="Cost for area/targets." data-ref="M20 p.504">Target / Area</label>
                            <select id="sel-targ" class="rit-select" onchange="recalculate()">
                                <option value="0">1 Target / Self (Touch)</option>
                                <option value="1">2-4 Ppl / ~5m Radius (+1)</option>
                                <option value="2">5-10 Ppl / ~10m Radius (+2)</option>
                                <option value="3">Mass / Building (+3)</option>
                            </select>
                        </div>

                        <div class="slider-card" data-title="Damage Effect" data-desc="1 Success buys 2 Levels of Damage." data-ref="M20 p.504">
                            <div class="slider-header">
                                <div>
                                    <label class="rit-label" style="margin:0; display:inline;">DAMAGE</label>
                                    <select id="sel-dmg-type" onchange="recalculate()" class="mini-sel">
                                        <option value="Lethal" style="color:var(--warning)">Lethal</option>
                                        <option value="Bashing" style="color:var(--accent)">Bashing</option>
                                        <option value="Aggravated" style="color:var(--danger)">Aggravated</option>
                                    </select>
                                </div>
                                <div style="text-align:right; line-height:1;">
                                    <div class="slider-val" id="txt-dmg">0 Levels</div>
                                    <div class="slider-cost" id="cost-dmg">+0 Suc</div>
                                </div>
                            </div>
                            <input type="range" id="rng-dmg" min="0" max="20" value="0" oninput="recalculate()">
                        </div>

                        <div class="input-group">
                            <label class="rit-label" data-title="Combo / Complexity" data-desc="Add +1 Success per extra Sphere or Feat." data-ref="M20 p.503">Other Feats / Combo</label>
                            <div class="counter">
                                <button class="btn-cnt" onclick="modifyState('extra', -1)">-</button>
                                <div class="cnt-display" id="val-extra">0</div>
                                <button class="btn-cnt" onclick="modifyState('extra', 1)">+</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="rit-label" style="color:var(--danger)" data-title="Opposition" data-desc="+1 Goal per opposing success/threshold." data-ref="M20 p.532">Opposition / Threshold</label>
                            <div class="counter" style="border-color:rgba(248, 113, 113, 0.3)">
                                <button class="btn-cnt" onclick="modifyState('resist', -1)">-</button>
                                <div class="cnt-display" id="val-resist" style="color:var(--danger)">0</div>
                                <button class="btn-cnt" onclick="modifyState('resist', 1)">+</button>
                            </div>
                        </div>
                    </div>

                    <button id="btn-cast" class="btn-cast style-inst" onclick="castSpell()">Cast Instant Spell</button>

                    <div id="log-container">
                        <div class="log-head">
                            <span id="log-title">Result</span> <span id="prog-txt"></span>
                        </div>
                        <div class="prog-bg"><div class="prog-fill" id="p-bar"></div></div>
                        <div class="log-scroll" id="logs"></div>
                    </div>
                </div>
            </div>

            <div id="sub-gens" class="sub-tab-content">
                <div class="gen-section">
                    <div class="tools-grid">
                        <div class="control-panel" style="grid-column: span 2;">
                            <label class="rit-label">QUICK DICE ROLLER</label>
                            <div style="display:flex; gap:12px; margin-top:10px; justify-content: center; align-items: flex-end;">
                                <div style="display:flex; flex-direction:column; gap:5px; align-items:center;">
                                    <span class="rit-label" style="font-size:0.65rem; color:var(--text-muted); letter-spacing:0.5px;">DICE POOL</span>
                                    <input type="number" id="q-pool" placeholder="#" value="6" class="gen-input" style="width:80px;">
                                </div>
                                <div style="display:flex; flex-direction:column; gap:5px; align-items:center;">
                                    <span class="rit-label" style="font-size:0.65rem; color:var(--text-muted); letter-spacing:0.5px;">DIFF</span>
                                    <input type="number" id="q-diff" placeholder="#" value="6" class="gen-input" style="width:80px;">
                                </div>
                                <button class="gen-btn" style="width: auto; margin:0; height:46px; background:var(--primary); color:#fff; padding: 0 24px; border:1px solid var(--primary);" onclick="quickRoll()">ROLL</button>
                            </div>
                            <div id="q-res" class="gen-res" style="font-size:1.4rem; margin-top:20px;">-</div>
                        </div>

                        <div class="control-panel">
                            <label class="rit-label">INSTANT NPC</label>
                            <button class="gen-btn" onclick="genNPC()">GENERATE</button>
                            <div id="res-npc" class="gen-res">...</div>
                        </div>

                        <div class="control-panel">
                            <label class="rit-label">RESONANCE</label>
                            <button class="gen-btn" onclick="genRes()">GENERATE</button>
                            <div id="res-rez" class="gen-res">...</div>
                        </div>

                        <div class="control-panel" style="grid-column: span 2;">
                            <label class="rit-label" style="color:var(--danger)">PARADOX FLAW</label>
                            <button class="gen-btn" style="border-color:var(--danger); color:var(--danger);" onclick="genFlaw()">SPARK CHAOS</button>
                            <div id="res-flaw" class="gen-res" style="color:#fff; font-weight:400;">...</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <footer class="site-footer">
        <div style="margin-bottom: 10px;">
            System: <span>Mage 20th Anniversary</span> // Architect: <span>Unkn0wn </span> // Protocol: <span>Active</span>
        </div>

        <button class="btn-report" onclick="openFeedback()">
            <svg viewBox="0 0 24 24">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
            </svg>
            Report Bug / Contact
        </button>
    </footer>

    <div id="feedback-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="rit-title" style="font-size:1rem; margin:0;">TRANSMISSION</h3>
                <span class="close-btn" onclick="closeFeedback()">&times;</span>
            </div>

            <form id="contactForm" onsubmit="sendFeedback(event)">
                <input type="hidden" name="access_key" value="6cf12a40-9f8e-4b22-b3a6-47b2616e0a25">

                <input type="checkbox" name="botcheck" class="hidden" style="display: none;">

                <div class="input-group">
                    <label class="rit-label">Identity (Optional)</label>
                    <input type="text" name="name" class="rit-select" placeholder="Mage Name or Email">
                </div>

                <div class="input-group" style="margin-top:10px;">
                    <label class="rit-label">Signal Data</label>
                    <textarea name="message" class="rit-select" rows="4" placeholder="Describe the glitch or request..." required style="resize: vertical;"></textarea>
                </div>

                <button type="submit" class="btn-cast style-rit" id="form-submit-btn" style="margin-top:15px; font-size: 0.9rem; padding: 15px;">SEND SIGNAL</button>
                <div id="form-result" style="margin-top:10px; font-size:0.8rem; display:none;"></div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
}